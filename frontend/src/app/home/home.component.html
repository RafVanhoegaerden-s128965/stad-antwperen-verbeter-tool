<div class="page">
  <div class="header">
    <h2 class="title">Slimme Verbetertool</h2>
    <button class="button logout" (click)="onLogout()">Uitloggen</button>
  </div>
  <div class="description">
    <label class="label title"
      >Deze tool kan gebruikt worden om teksten te verbeteren aan de hand van de
      correcte huisstijlgids voor verschillende media. U kunt uw originele tekst
      invoeren en het gewenste mediumtype selecteren (artikel, sociale media,
      TikTok of sms). De tool genereert vervolgens een verbeterde versie die
      past bij de gekozen stijl. Het systeem biedt ook specifieke suggesties
      voor verbeteringen, die u per stuk kunt accepteren of weigeren. Bent u
      tevreden met het resultaat? Dan kunt u de definitieve tekst opslaan. Deze
      tool is ideaal voor het consistent houden van uw communicatie over
      verschillende mediakanalen.
    </label>
  </div>

  <div class="body">
    <form [formGroup]="textForm" class="form">
      <div class="text-fields">
        <!-- Original text area -->
        <div class="input-container">
          <label class="label">Originele tekst</label>
          <textarea
            formControlName="inputText"
            placeholder="Voer hier je originele tekst in..."
            class="text-area"
          ></textarea>
        </div>

        <!-- Generated text area (now a contenteditable div for highlighting) -->
        <div class="field">
          <label class="label">Gegenereerde tekst</label>
          <div class="generated-text-container">
            <div
              class="generated-text-view"
              contenteditable="true"
              [class.loading]="isLoading"
              (input)="onGeneratedTextChange($event)"
              #generatedTextDiv
            ></div>
            <div *ngIf="isLoading" class="loader-container">
              <div class="loader"></div>
              <span>Bezig met genereren...</span>
            </div>
          </div>
          <label class="label-helper">
            Bent u niet tevreden met het resultaat? Pas eventueel aan en druk vervolgens op finaliseer!
          </label>
        </div>        
      </div>

      <!-- Suggestions area -->
      <div class="suggestions-box" [class.visible]="suggestions.length > 0">
        <label class="label">Suggesties</label>
        <div class="suggestions-container">
          <div
            *ngFor="let suggestion of suggestions; let i = index"
            class="suggestion-item"
          >
            <div class="suggestion-content">
              <div class="original-text">
                <strong>Originele tekst:</strong>
                <p>{{ suggestion.incorrect_part }}</p>
              </div>
              <div class="corrected-text">
                <strong>Suggestie:</strong>
                <p>{{ suggestion.corrected_part }}</p>
              </div>
              <div class="explanation">
                <small>{{ suggestion.explanation }}</small>
              </div>
            </div>
            <div class="suggestion-actions">
              <button
                type="button"
                class="button accept"
                (click)="acceptSuggestionById(suggestion.id)"
              >
                Accepteren
              </button>
              <button
                type="button"
                class="button logout"
                (click)="rejectSuggestionById(suggestion.id)"
              >
                Weigeren
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="controls">
        <div class="select-container">
          <label class="label">Medium type</label>
          <select formControlName="mediumType" class="select" id="mediumTypeSelect">
            <option value="" disabled style="color: #d0d0d0">
              Selecteer een medium
            </option>
            <option value="article">Artikel</option>
            <option value="socialmedia">Sociale media</option>
            <option value="tiktok">TikTok</option>
            <option value="sms">sms</option>
          </select>
        </div>

        <div class="buttons">
          <button
            type="button"
            class="button generalize"
            (click)="onGeneralize()"
          >
            Genereer
          </button>
          <button type="button" class="button finalize" (click)="onFinalize()">
            Opslaan
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Tooltip template -->
<div class="suggestion-tooltip"
     *ngIf="tooltipVisible"
     [style.top.px]="tooltipY"
     [style.left.px]="tooltipX"
     (mouseenter)="onTooltipMouseEnter()"
     (mouseleave)="onTooltipMouseLeave()">
  <div class="tooltip-content">
    <div *ngFor="let suggestion of currentTooltipSuggestions">
      <strong>Originele tekst:</strong> {{ suggestion.incorrect_part }}<br>
      <strong>Suggestie:</strong> {{ suggestion.corrected_part }}<br>
      <small>{{ suggestion.explanation }}</small>
      <div class="tooltip-actions">
        <button class="button accept" (click)="acceptSuggestionById(suggestion.id)">Accepteren</button>
        <button class="button logout" (click)="rejectSuggestionById(suggestion.id)">Weigeren</button>
      </div>
      <hr *ngIf="suggestion !== currentTooltipSuggestions[currentTooltipSuggestions.length - 1]">
    </div>
  </div>
</div>

